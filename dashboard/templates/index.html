<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loot Logger Dashboard - by Kazz</title>
    
    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#faf5ff',
                            100: '#f3e8ff',
                            200: '#e9d5ff',
                            300: '#d8b4fe',
                            400: '#c084fc',
                            500: '#a855f7',
                            600: '#9333ea',
                            700: '#7e22ce',
                            800: '#6b21a8',
                            900: '#581c87',
                            950: '#3b0764',
                        },
                        dark: {
                            50: '#18181b',
                            100: '#27272a',
                            200: '#3f3f46',
                            300: '#52525b',
                            400: '#71717a',
                            500: '#a1a1aa',
                            600: '#d4d4d8',
                            700: '#e4e4e7',
                            800: '#f4f4f5',
                            900: '#fafafa',
                            bg: '#09090b',
                            card: '#0f0f12',
                            elevated: '#18181b',
                            border: '#27272a',
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #3f3f46;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #52525b;
        }
        
        /* Animations */
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.4); }
            50% { box-shadow: 0 0 20px 5px rgba(168, 85, 247, 0.2); }
        }
        
        .loot-row-new {
            animation: slideIn 0.3s ease-out;
        }
        
        .rare-row {
            background: linear-gradient(90deg, rgba(168, 85, 247, 0.08) 0%, transparent 100%);
            border-left: 2px solid #a855f7;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #0f0f12 0%, #18181b 100%);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }
        
        /* Item image */
        .item-image {
            transition: all 0.2s ease;
        }
        
        .item-image:hover {
            transform: scale(1.1);
            border-color: #a855f7;
        }
        
        /* Tooltip */
        .item-tooltip {
            transform: translateX(-50%) translateY(-5px);
            transition: all 0.2s ease;
        }
        
        .group:hover .item-tooltip {
            transform: translateX(-50%) translateY(0);
        }
        
        /* Custom checkbox */
        .custom-checkbox {
            appearance: none;
            width: 16px;
            height: 16px;
            border: 2px solid #3f3f46;
            border-radius: 4px;
            background: transparent;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        
        .custom-checkbox:checked {
            background: #a855f7;
            border-color: #a855f7;
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
        }
        
        .custom-checkbox:hover {
            border-color: #a855f7;
        }
        
        /* Tier colors */
        .tier-4 { color: #60a5fa; }
        .tier-5 { color: #f59e0b; }
        .tier-6 { color: #f97316; }
        .tier-7 { color: #ef4444; }
        .tier-8 { color: #a855f7; }
        
        /* Glass effect */
        .glass {
            background: rgba(15, 15, 18, 0.8);
            backdrop-filter: blur(10px);
        }
        
        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #a855f7 0%, #6366f1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* ========================================
           SPLASH SCREEN - MODERN VERSION
           ======================================== */
        
        .splash-screen {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background: #09090b;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.8s ease, visibility 0.8s ease;
            overflow: hidden;
        }
        
        .splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        /* Animated grid background */
        .splash-grid {
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(rgba(168, 85, 247, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(168, 85, 247, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
        }
        
        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        
        /* Glow orbs */
        .splash-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            animation: orbFloat 8s ease-in-out infinite;
        }
        
        .splash-orb-1 {
            width: 400px;
            height: 400px;
            background: rgba(168, 85, 247, 0.15);
            top: -100px;
            left: -100px;
            animation-delay: 0s;
        }
        
        .splash-orb-2 {
            width: 300px;
            height: 300px;
            background: rgba(99, 102, 241, 0.1);
            bottom: -50px;
            right: -50px;
            animation-delay: -4s;
        }
        
        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(30px, -30px) scale(1.1); }
        }
        
        /* Scan line effect */
        .splash-scanline {
            position: absolute;
            inset: 0;
            background: linear-gradient(
                180deg,
                transparent 0%,
                rgba(168, 85, 247, 0.03) 50%,
                transparent 100%
            );
            height: 100px;
            animation: scanline 3s linear infinite;
            pointer-events: none;
        }
        
        @keyframes scanline {
            0% { transform: translateY(-100px); }
            100% { transform: translateY(100vh); }
        }
        
        /* Logo container */
        .splash-logo-container {
            position: relative;
            margin-bottom: 2rem;
        }
        
        .splash-logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #a855f7 0%, #6366f1 50%, #a855f7 100%);
            background-size: 200% 200%;
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: logoGradient 3s ease infinite, logoFloat 3s ease-in-out infinite;
            box-shadow: 
                0 0 60px rgba(168, 85, 247, 0.4),
                0 0 100px rgba(168, 85, 247, 0.2),
                inset 0 0 30px rgba(255, 255, 255, 0.1);
        }
        
        @keyframes logoGradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        @keyframes logoFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .splash-logo-ring {
            position: absolute;
            inset: -10px;
            border: 2px solid transparent;
            border-radius: 34px;
            border-top-color: rgba(168, 85, 247, 0.5);
            animation: ringRotate 2s linear infinite;
        }
        
        .splash-logo-ring-2 {
            inset: -20px;
            border-radius: 40px;
            animation: ringRotate 3s linear infinite reverse;
            border-top-color: rgba(99, 102, 241, 0.3);
        }
        
        @keyframes ringRotate {
            to { transform: rotate(360deg); }
        }
        
        /* Title with glitch effect */
        .splash-title {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, #a855f7 50%, #fff 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleShine 3s linear infinite;
            position: relative;
        }
        
        @keyframes titleShine {
            0% { background-position: 200% center; }
            100% { background-position: -200% center; }
        }
        
        /* Progress bar */
        .splash-progress-container {
            width: 280px;
            height: 4px;
            background: rgba(39, 39, 42, 0.8);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 2rem;
            position: relative;
        }
        
        .splash-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #a855f7, #6366f1, #a855f7);
            background-size: 200% 100%;
            border-radius: 4px;
            animation: progressFill 2.5s ease-out forwards, progressShine 1s linear infinite;
        }
        
        @keyframes progressFill {
            0% { width: 0%; }
            20% { width: 20%; }
            40% { width: 45%; }
            60% { width: 70%; }
            80% { width: 85%; }
            100% { width: 100%; }
        }
        
        @keyframes progressShine {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Status text with typewriter */
        .splash-status {
            margin-top: 1.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            color: #71717a;
        }
        
        .splash-status-text {
            display: inline-block;
            overflow: hidden;
            white-space: nowrap;
            animation: typewriter 2s steps(30) forwards;
            border-right: 2px solid #a855f7;
        }
        
        @keyframes typewriter {
            0% { width: 0; }
            100% { width: 100%; }
        }
        
        /* Particles */
        .splash-particles {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
        }
        
        .splash-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #a855f7;
            border-radius: 50%;
            animation: particleRise 4s ease-in infinite;
            opacity: 0;
        }
        
        @keyframes particleRise {
            0% { 
                transform: translateY(100vh) scale(0);
                opacity: 0;
            }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { 
                transform: translateY(-100px) scale(1);
                opacity: 0;
            }
        }
        
        /* Version badge */
        .splash-version {
            position: absolute;
            bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(39, 39, 42, 0.5);
            border: 1px solid rgba(63, 63, 70, 0.5);
            border-radius: 9999px;
            font-size: 0.75rem;
            color: #71717a;
        }
        
        .splash-version-dot {
            width: 6px;
            height: 6px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        
        /* ========================================
           MELHORIAS VISUAIS - HOVER EFFECTS
           ======================================== */
        
        /* Hover nas linhas da tabela */
        tbody tr {
            transition: all 0.2s ease;
        }
        
        tbody tr:hover {
            background: rgba(168, 85, 247, 0.05) !important;
            transform: scale(1.002);
        }
        
        /* Rare row pulse */
        .rare-row {
            animation: rarePulse 3s ease-in-out infinite;
        }
        
        @keyframes rarePulse {
            0%, 100% { background: linear-gradient(90deg, rgba(168, 85, 247, 0.08) 0%, transparent 100%); }
            50% { background: linear-gradient(90deg, rgba(168, 85, 247, 0.15) 0%, transparent 100%); }
        }
        
        /* Sidebar items hover */
        .sidebar-item {
            transition: all 0.2s ease;
        }
        
        .sidebar-item:hover {
            background: rgba(168, 85, 247, 0.1);
            transform: translateX(4px);
        }
        
        /* Button hover effects */
        .btn-hover {
            position: relative;
            overflow: hidden;
        }
        
        .btn-hover::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }
        
        .btn-hover:hover::after {
            transform: translateX(100%);
        }
        
        /* Stat card glow on hover */
        .stat-card {
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(168, 85, 247, 0.1), transparent);
            transition: left 0.5s ease;
        }
        
        .stat-card:hover::before {
            left: 100%;
        }
        
        /* ========================================
           ODOMETER ANIMATION
           ======================================== */
        
        .odometer {
            display: inline-block;
            transition: all 0.5s ease-out;
        }
        
        .odometer-digit {
            display: inline-block;
            animation: countUp 0.3s ease-out;
        }
        
        @keyframes countUp {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-dark-bg text-dark-600 min-h-screen" x-data="dashboard()">
    
    <!-- ========================================
         SPLASH SCREEN - MODERN VERSION
         ======================================== -->
    <div class="splash-screen" id="splashScreen">
        <!-- Animated background grid -->
        <div class="splash-grid"></div>
        
        <!-- Floating orbs -->
        <div class="splash-orb splash-orb-1"></div>
        <div class="splash-orb splash-orb-2"></div>
        
        <!-- Scan line effect -->
        <div class="splash-scanline"></div>
        
        <!-- Floating particles -->
        <div class="splash-particles" id="particles"></div>
        
        <!-- Main content -->
        <div class="flex flex-col items-center relative z-10">
            <!-- Logo with rings -->
            <div class="splash-logo-container">
                <div class="splash-logo-ring"></div>
                <div class="splash-logo-ring splash-logo-ring-2"></div>
                <div class="splash-logo">
                    <svg class="w-12 h-12 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                        <line x1="12" y1="22.08" x2="12" y2="12"/>
                    </svg>
                </div>
            </div>
            
            <!-- Title -->
            <h1 class="splash-title mt-6">LOOT LOGGER</h1>
            <p class="text-dark-400 text-sm mt-2 tracking-widest uppercase">Dashboard</p>
            
            <!-- Progress bar -->
            <div class="splash-progress-container">
                <div class="splash-progress-bar"></div>
            </div>
            
            <!-- Status text -->
            <div class="splash-status">
                <span class="splash-status-text">Iniciando Loot Logger...</span>
            </div>
        </div>
        
        <!-- Version badge -->
        <div class="splash-version">
            <div class="splash-version-dot"></div>
            <span>v2.0</span>
            <span class="text-dark-300">•</span>
            <span>Open Source by Kazz</span>
        </div>
    </div>
    
    <!-- ========================================
         MAIN DASHBOARD
         ======================================== -->
    <div class="flex h-screen overflow-hidden" id="mainDashboard" style="opacity: 0; transition: opacity 0.5s ease;">
        
        <!-- Sidebar Filters -->
        <aside class="w-72 bg-dark-card border-r border-dark-border flex flex-col h-full">
            
            <!-- Logo -->
            <div class="p-5 border-b border-dark-border">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-primary-500 to-primary-700 rounded-xl flex items-center justify-center shadow-lg shadow-primary-500/20">
                        <i data-lucide="box" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-white">Loot Logger</h1>
                        <p class="text-xs text-dark-400">Dashboard v2.0</p>
                    </div>
                </div>
            </div>
            
            <!-- Filters -->
            <div class="flex-1 overflow-y-auto p-4 space-y-6">
                
                <!-- Search -->
                <div>
                    <label class="text-xs font-semibold text-dark-400 uppercase tracking-wider mb-2 block">Busca</label>
                    <div class="relative">
                        <i data-lucide="search" class="w-4 h-4 text-dark-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
                        <input type="text" 
                               x-model="filters.search"
                               placeholder="Buscar item ou player..."
                               class="w-full bg-dark-elevated border border-dark-border rounded-lg pl-10 pr-4 py-2.5 text-sm text-white placeholder-dark-400 focus:outline-none focus:border-primary-500 focus:ring-1 focus:ring-primary-500/50 transition-all">
                    </div>
                </div>
                
                <!-- Tier Filter -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <label class="text-xs font-semibold text-dark-400 uppercase tracking-wider">Tier</label>
                        <button @click="toggleAllTiers()" class="text-xs text-primary-400 hover:text-primary-300 transition-colors">
                            <span x-text="allTiersSelected ? 'Limpar' : 'Todos'"></span>
                        </button>
                    </div>
                    <div class="flex gap-2">
                        <template x-for="tier in [4, 5, 6, 7, 8]" :key="tier">
                            <button @click="toggleTier(tier)"
                                    :class="filters.tiers.includes(tier) 
                                        ? 'bg-primary-500/20 border-primary-500 text-primary-400' 
                                        : 'bg-dark-elevated border-dark-border text-dark-400 hover:border-dark-300'"
                                    class="flex-1 py-2 rounded-lg border text-sm font-bold transition-all">
                                <span x-text="'T' + tier"></span>
                            </button>
                        </template>
                    </div>
                </div>
                
                <!-- Category Filter -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <label class="text-xs font-semibold text-dark-400 uppercase tracking-wider">Categoria</label>
                        <button @click="toggleAllCategories()" class="text-xs text-primary-400 hover:text-primary-300 transition-colors">
                            <span x-text="allCategoriesSelected ? 'Limpar' : 'Todas'"></span>
                        </button>
                    </div>
                    <div class="space-y-2">
                        <template x-for="cat in categories" :key="cat.id">
                            <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-dark-elevated cursor-pointer transition-colors group">
                                <input type="checkbox" 
                                       :checked="filters.categories.includes(cat.id)"
                                       @change="toggleCategory(cat.id)"
                                       class="custom-checkbox">
                                <span class="text-sm text-dark-500 group-hover:text-dark-600" x-text="cat.name"></span>
                                <span class="ml-auto text-xs text-dark-400 bg-dark-elevated px-2 py-0.5 rounded-full" 
                                      x-text="getCategoryCount(cat.id)"></span>
                            </label>
                        </template>
                    </div>
                </div>
                
                <!-- Players Filter -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <label class="text-xs font-semibold text-dark-400 uppercase tracking-wider">Jogadores</label>
                        <span class="text-xs text-dark-400" x-text="players.length + ' ativos'"></span>
                    </div>
                    <div class="space-y-1 max-h-48 overflow-y-auto">
                        <template x-if="players.length === 0">
                            <p class="text-sm text-dark-400 italic p-2">Nenhum jogador detectado</p>
                        </template>
                        <template x-for="player in players" :key="player">
                            <label class="flex items-center gap-3 p-2 rounded-lg hover:bg-dark-elevated cursor-pointer transition-colors group">
                                <input type="checkbox" 
                                       :checked="filters.players.includes(player)"
                                       @change="togglePlayer(player)"
                                       class="custom-checkbox">
                                <i data-lucide="user" class="w-4 h-4 text-dark-400"></i>
                                <span class="text-sm text-dark-500 group-hover:text-dark-600 truncate" x-text="player"></span>
                                <span class="ml-auto text-xs text-dark-400 bg-dark-elevated px-2 py-0.5 rounded-full" 
                                      x-text="getPlayerLootCount(player)"></span>
                            </label>
                        </template>
                    </div>
                </div>
                
                <!-- Rare Only -->
                <div>
                    <label class="flex items-center gap-3 p-3 rounded-lg bg-dark-elevated border border-dark-border hover:border-primary-500/50 cursor-pointer transition-all">
                        <input type="checkbox" 
                               x-model="filters.rareOnly"
                               class="custom-checkbox">
                        <span class="text-sm font-medium text-white">Apenas Raros</span>
                    </label>
                </div>
                
            </div>
            
            <!-- Footer -->
            <div class="p-4 border-t border-dark-border">
                <button @click="clearFilters()" 
                        class="w-full py-2.5 rounded-lg border border-dark-border text-dark-400 hover:text-white hover:border-dark-300 transition-all text-sm font-medium flex items-center justify-center gap-2">
                    <i data-lucide="filter-x" class="w-4 h-4"></i>
                    Limpar Filtros
                </button>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden">
            
            <!-- Header -->
            <header class="bg-dark-card border-b border-dark-border px-6 py-4">
                <div class="flex items-center justify-between">
                    
                    <!-- Stats -->
                    <div class="flex items-center gap-4">
                        <!-- Total Loots -->
                        <div class="stat-card px-4 py-3 rounded-xl border border-dark-border">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-primary-500/10 rounded-lg flex items-center justify-center">
                                    <i data-lucide="package" class="w-5 h-5 text-primary-400"></i>
                                </div>
                                <div>
                                    <p class="text-xs text-dark-400">Total Loots</p>
                                    <p class="text-xl font-bold text-white odometer" 
                                       x-text="stats.total_loots.toLocaleString()"
                                       x-effect="$el.classList.add('odometer-digit'); setTimeout(() => $el.classList.remove('odometer-digit'), 300)">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Total Items -->
                        <div class="stat-card px-4 py-3 rounded-xl border border-dark-border">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-blue-500/10 rounded-lg flex items-center justify-center">
                                    <i data-lucide="layers" class="w-5 h-5 text-blue-400"></i>
                                </div>
                                <div>
                                    <p class="text-xs text-dark-400">Total Itens</p>
                                    <p class="text-xl font-bold text-white odometer" 
                                       x-text="stats.total_items.toLocaleString()"
                                       x-effect="$el.classList.add('odometer-digit'); setTimeout(() => $el.classList.remove('odometer-digit'), 300)">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Players -->
                        <div class="stat-card px-4 py-3 rounded-xl border border-dark-border">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-green-500/10 rounded-lg flex items-center justify-center">
                                    <i data-lucide="users" class="w-5 h-5 text-green-400"></i>
                                </div>
                                <div>
                                    <p class="text-xs text-dark-400">Players</p>
                                    <p class="text-xl font-bold text-white odometer" 
                                       x-text="stats.players_active"
                                       x-effect="$el.classList.add('odometer-digit'); setTimeout(() => $el.classList.remove('odometer-digit'), 300)">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Session Time -->
                        <div class="stat-card px-4 py-3 rounded-xl border border-dark-border">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-amber-500/10 rounded-lg flex items-center justify-center">
                                    <i data-lucide="clock" class="w-5 h-5 text-amber-400"></i>
                                </div>
                                <div>
                                    <p class="text-xs text-dark-400">Sessão</p>
                                    <p class="text-xl font-bold text-white font-mono" x-text="sessionTime">00:00:00</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Total Value -->
                        <div class="stat-card px-4 py-3 rounded-xl border border-amber-500/30 bg-gradient-to-r from-amber-500/5 to-transparent">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-amber-500/20 rounded-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 text-amber-400" viewBox="0 0 24 24" fill="currentColor">
                                        <circle cx="12" cy="12" r="10"/>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-xs text-amber-400/80">Valor Estimado</p>
                                    <p class="text-xl font-bold text-amber-400 odometer" 
                                       x-text="formatSilver(totalEstimatedValue)"
                                       x-effect="$el.classList.add('odometer-digit'); setTimeout(() => $el.classList.remove('odometer-digit'), 300)">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Status & Actions -->
                    <div class="flex items-center gap-4">
                        <!-- Connection Status -->
                        <div class="flex items-center gap-3">
                            <div class="flex items-center gap-2 px-3 py-1.5 rounded-full" :class="statusClass">
                                <span class="w-2 h-2 rounded-full animate-pulse" :class="statusDotClass"></span>
                                <span class="text-xs font-medium" x-text="statusText"></span>
                            </div>
                            
                            <div class="flex items-center gap-2 px-3 py-1.5 rounded-full" 
                                 :class="connected ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'">
                                <i data-lucide="wifi" class="w-3 h-3"></i>
                                <span class="text-xs font-medium" x-text="connected ? 'Live' : 'Offline'"></span>
                            </div>
                        </div>
                        
                        <!-- Clear Button -->
                        <button @click="clearLoots()" 
                                class="px-4 py-2 bg-red-500/10 text-red-400 rounded-lg hover:bg-red-500/20 transition-all text-sm font-medium flex items-center gap-2 border border-red-500/20">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                            Limpar
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Loot Table -->
            <div class="flex-1 overflow-hidden p-6">
                <div class="bg-dark-card border border-dark-border rounded-2xl h-full flex flex-col overflow-hidden">
                    
                    <!-- Table Header Info -->
                    <div class="flex items-center justify-between px-6 py-4 border-b border-dark-border bg-dark-elevated/50">
                        <div class="flex items-center gap-3">
                            <i data-lucide="scroll-text" class="w-5 h-5 text-primary-400"></i>
                            <h2 class="text-base font-semibold text-white">Eventos de Loot</h2>
                            <span class="text-sm text-dark-400" x-text="'(' + filteredLoots.length + ' de ' + loots.length + ')'"></span>
                        </div>
                        
                        <div class="flex items-center gap-2 text-xs text-dark-400">
                            <i data-lucide="info" class="w-3.5 h-3.5"></i>
                            <span>Atualização em tempo real</span>
                        </div>
                    </div>
                    
                    <!-- Table -->
                    <div class="flex-1 overflow-auto">
                        <table class="w-full">
                            <thead class="bg-dark-elevated/80 sticky top-0 z-10">
                                <tr class="text-left text-dark-400 text-xs uppercase tracking-wider">
                                    <th class="px-4 py-3 font-semibold w-20">Horário</th>
                                    <th class="px-2 py-3 font-semibold w-14 text-center">Item</th>
                                    <th class="px-4 py-3 font-semibold">Nome</th>
                                    <th class="px-4 py-3 font-semibold text-center w-14">Qtd</th>
                                    <th class="px-4 py-3 font-semibold w-16">Tier</th>
                                    <th class="px-4 py-3 font-semibold w-24 text-right">Valor</th>
                                    <th class="px-4 py-3 font-semibold">Pegou</th>
                                    <th class="px-4 py-3 font-semibold">Origem</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-dark-border/50">
                                <template x-for="loot in filteredLoots" :key="loot.id">
                                    <tr class="hover:bg-dark-elevated/30 transition-colors loot-row-new"
                                        :class="loot.tier.is_rare ? 'rare-row' : ''">
                                        <td class="px-4 py-3">
                                            <span class="font-mono text-sm text-dark-400" x-text="loot.timestamp_display"></span>
                                        </td>
                                        <td class="px-2 py-3 text-center">
                                            <div class="relative group">
                                                <img :src="getItemImageUrl(loot.item_id)" 
                                                     :alt="loot.item_name"
                                                     class="item-image w-10 h-10 rounded-lg bg-dark-elevated border border-dark-border object-contain cursor-pointer"
                                                     loading="lazy"
                                                     @error="$event.target.src = 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22 fill=%22none%22 stroke=%22%2371717a%22 stroke-width=%222%22><path d=%22M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z%22/></svg>'">
                                                <!-- Tooltip -->
                                                <div class="item-tooltip absolute bottom-full left-1/2 mb-2 px-3 py-2 bg-dark-elevated border border-dark-border rounded-lg shadow-xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none z-50 whitespace-nowrap">
                                                    <img :src="getItemImageUrl(loot.item_id, 100)" 
                                                         :alt="loot.item_name"
                                                         class="w-24 h-24 mx-auto mb-2 rounded-lg bg-dark-card">
                                                    <p class="text-sm text-white font-medium text-center" x-text="loot.item_name"></p>
                                                    <p class="text-xs text-dark-400 text-center font-mono mt-1" x-text="loot.item_id"></p>
                                                    <p class="text-xs text-center mt-1" :style="'color: ' + getEnchantColor(loot.tier.display)" x-text="loot.tier.display || ''"></p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center gap-2">
                                                <span class="text-white font-medium" x-text="loot.item_name"></span>
                                                <template x-if="loot.tier.is_rare">
                                                    <span class="px-2 py-0.5 bg-primary-500/20 text-primary-300 text-xs rounded-full font-semibold">
                                                        RARO
                                                    </span>
                                                </template>
                                            </div>
                                            <span class="text-xs text-dark-400 font-mono" x-text="loot.item_id"></span>
                                        </td>
                                        <td class="px-4 py-3 text-center">
                                            <span class="inline-flex items-center justify-center min-w-[32px] px-2 py-1 bg-dark-elevated rounded-lg font-mono text-sm font-medium text-white" x-text="loot.quantity"></span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <span class="font-mono text-sm font-bold" 
                                                  :style="'color: ' + getEnchantColor(loot.tier.display)"
                                                  x-text="loot.tier.display || '-'"></span>
                                        </td>
                                        <td class="px-4 py-3 text-right">
                                            <div class="flex items-center justify-end gap-1">
                                                <template x-if="loot.estimatedPrice !== undefined">
                                                    <span class="font-mono text-sm text-amber-400 font-medium" 
                                                          x-text="loot.estimatedPrice > 0 ? formatSilver(loot.estimatedPrice * loot.quantity) : '-'"></span>
                                                </template>
                                                <template x-if="loot.estimatedPrice === undefined">
                                                    <span class="text-dark-400 text-xs">...</span>
                                                </template>
                                                <template x-if="loot.estimatedPrice > 0">
                                                    <svg class="w-3.5 h-3.5 text-amber-400" viewBox="0 0 24 24" fill="currentColor">
                                                        <circle cx="12" cy="12" r="10"/>
                                                    </svg>
                                                </template>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center gap-2">
                                                <div class="w-7 h-7 bg-primary-500/10 rounded-full flex items-center justify-center">
                                                    <i data-lucide="user" class="w-3.5 h-3.5 text-primary-400"></i>
                                                </div>
                                                <div>
                                                    <span class="text-white font-medium" x-text="loot.looted_by.name"></span>
                                                    <template x-if="loot.looted_by.guild">
                                                        <span class="text-primary-400 text-xs ml-1" x-text="'[' + loot.looted_by.guild + ']'"></span>
                                                    </template>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <span class="text-dark-400 text-sm" x-text="formatOrigin(loot.looted_from.name)"></span>
                                        </td>
                                    </tr>
                                </template>
                                
                                <!-- Empty State -->
                                <template x-if="filteredLoots.length === 0">
                                    <tr>
                                        <td colspan="8" class="px-6 py-16 text-center">
                                            <div class="flex flex-col items-center">
                                                <div class="w-20 h-20 bg-dark-elevated rounded-2xl flex items-center justify-center mb-4">
                                                    <i data-lucide="package-open" class="w-10 h-10 text-dark-300"></i>
                                                </div>
                                                <p class="text-dark-400 font-medium">Nenhum loot encontrado</p>
                                                <p class="text-dark-300 text-sm mt-1" x-text="loots.length > 0 ? 'Tente ajustar os filtros' : 'Os loots aparecerão aqui em tempo real'"></p>
                                            </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <footer class="bg-dark-card border-t border-dark-border px-6 py-3">
                <div class="flex items-center justify-between text-xs text-dark-400">
                    <div class="flex items-center gap-2">
                        <span>Loot Logger Dashboard</span>
                        <span class="text-dark-300">•</span>
                        <span>Open Source by <span class="text-primary-400 font-medium">Kazz</span></span>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="font-mono">ws://127.0.0.1:5000</span>
                    </div>
                </div>
            </footer>
        </main>
    </div>
    
    <script>
        function dashboard() {
            return {
                // State
                connected: false,
                socket: null,
                loots: [],
                players: [],
                stats: {
                    total_loots: 0,
                    total_items: 0,
                    players_active: 0,
                    status: 'offline',
                    session_start: null
                },
                sessionTime: '00:00:00',
                sessionTimer: null,
                
                // Filters
                filters: {
                    search: '',
                    tiers: [4, 5, 6, 7, 8],
                    categories: ['equipment', 'consumable', 'resource', 'rune', 'other'],
                    players: [],
                    rareOnly: false
                },
                
                // Categories config
                categories: [
                    { id: 'equipment', name: 'Equipamentos' },
                    { id: 'consumable', name: 'Consumíveis' },
                    { id: 'resource', name: 'Recursos' },
                    { id: 'rune', name: 'Runas' },
                    { id: 'other', name: 'Outros' }
                ],
                
                // Computed
                get filteredLoots() {
                    return this.loots.filter(loot => {
                        // Search filter
                        if (this.filters.search) {
                            const search = this.filters.search.toLowerCase();
                            const matchesSearch = 
                                loot.item_name.toLowerCase().includes(search) ||
                                loot.item_id.toLowerCase().includes(search) ||
                                loot.looted_by.name.toLowerCase().includes(search) ||
                                loot.looted_from.name.toLowerCase().includes(search);
                            if (!matchesSearch) return false;
                        }
                        
                        // Tier filter
                        if (this.filters.tiers.length > 0 && loot.tier.display) {
                            const tierMatch = loot.tier.display.match(/T(\d)/);
                            if (tierMatch) {
                                const tier = parseInt(tierMatch[1]);
                                if (!this.filters.tiers.includes(tier)) return false;
                            }
                        }
                        
                        // Category filter
                        if (this.filters.categories.length > 0) {
                            const category = this.getItemCategory(loot.item_id);
                            if (!this.filters.categories.includes(category)) return false;
                        }
                        
                        // Player filter
                        if (this.filters.players.length > 0) {
                            if (!this.filters.players.includes(loot.looted_by.name)) return false;
                        }
                        
                        // Rare only
                        if (this.filters.rareOnly && !loot.tier.is_rare) return false;
                        
                        return true;
                    });
                },
                
                get allTiersSelected() {
                    return this.filters.tiers.length === 5;
                },
                
                get allCategoriesSelected() {
                    return this.filters.categories.length === 5;
                },
                
                get totalEstimatedValue() {
                    return this.loots.reduce((total, loot) => {
                        if (loot.estimatedPrice && loot.estimatedPrice > 0) {
                            return total + (loot.estimatedPrice * loot.quantity);
                        }
                        return total;
                    }, 0);
                },
                
                get statusClass() {
                    switch(this.stats.status) {
                        case 'online': return 'bg-green-500/10 text-green-400';
                        case 'connecting': return 'bg-amber-500/10 text-amber-400';
                        default: return 'bg-dark-elevated text-dark-400';
                    }
                },
                
                get statusDotClass() {
                    switch(this.stats.status) {
                        case 'online': return 'bg-green-500';
                        case 'connecting': return 'bg-amber-500';
                        default: return 'bg-dark-300';
                    }
                },
                
                get statusText() {
                    switch(this.stats.status) {
                        case 'online': return 'Albion Detectado';
                        case 'connecting': return 'Conectando...';
                        default: return 'Aguardando...';
                    }
                },
                
                // Lifecycle
                init() {
                    this.connectSocket();
                    this.loadHistory();
                    this.startSessionTimer();
                    
                    // Init icons after Alpine renders
                    this.$nextTick(() => {
                        lucide.createIcons();
                    });
                },
                
                // WebSocket
                connectSocket() {
                    this.socket = io();
                    
                    this.socket.on('connect', () => {
                        console.log('[WS] Conectado');
                        this.connected = true;
                    });
                    
                    this.socket.on('disconnect', () => {
                        console.log('[WS] Desconectado');
                        this.connected = false;
                    });
                    
                    this.socket.on('new_loot', (loot) => {
                        console.log('[WS] Novo loot:', loot);
                        this.loots.unshift(loot);
                        
                        // Fetch price for new item
                        this.fetchItemPrice(loot);
                        
                        // Update players list
                        if (!this.players.includes(loot.looted_by.name) && !loot.looted_by.name.startsWith('@')) {
                            this.players.push(loot.looted_by.name);
                        }
                        
                        // Limit to 500 items
                        if (this.loots.length > 500) {
                            this.loots = this.loots.slice(0, 500);
                        }
                        
                        // Re-init icons for new row
                        this.$nextTick(() => lucide.createIcons());
                    });
                    
                    this.socket.on('stats', (stats) => {
                        this.stats = { ...this.stats, ...stats };
                    });
                    
                    this.socket.on('status', (data) => {
                        this.stats.status = data.status;
                    });
                    
                    this.socket.on('history', (data) => {
                        this.loots = data.loots.reverse();
                        this.updatePlayersList();
                        this.$nextTick(() => lucide.createIcons());
                    });
                    
                    this.socket.on('clear', () => {
                        this.loots = [];
                        this.players = [];
                        this.stats.total_loots = 0;
                        this.stats.total_items = 0;
                        this.stats.players_active = 0;
                    });
                },
                
                // Load initial data
                loadHistory() {
                    fetch('/api/loots/recent?limit=100')
                        .then(r => r.json())
                        .then(data => {
                            if (data.loots && data.loots.length > 0) {
                                this.loots = data.loots;
                                this.updatePlayersList();
                                this.$nextTick(() => lucide.createIcons());
                                
                                // Fetch prices for loaded items (batch)
                                this.fetchPricesForLoots(this.loots);
                            }
                        })
                        .catch(err => console.error('[API] Erro:', err));
                    
                    fetch('/api/stats')
                        .then(r => r.json())
                        .then(data => {
                            this.stats = { ...this.stats, ...data };
                        })
                        .catch(err => console.error('[API] Erro:', err));
                },
                
                // Session timer - FIXED
                startSessionTimer() {
                    const updateTimer = () => {
                        if (!this.stats.session_start) {
                            this.sessionTime = '00:00:00';
                            return;
                        }
                        
                        const start = new Date(this.stats.session_start);
                        const now = new Date();
                        let diff = Math.floor((now - start) / 1000);
                        
                        // Ensure non-negative
                        if (diff < 0) diff = 0;
                        
                        const hours = Math.floor(diff / 3600).toString().padStart(2, '0');
                        const minutes = Math.floor((diff % 3600) / 60).toString().padStart(2, '0');
                        const seconds = (diff % 60).toString().padStart(2, '0');
                        
                        this.sessionTime = `${hours}:${minutes}:${seconds}`;
                    };
                    
                    updateTimer();
                    this.sessionTimer = setInterval(updateTimer, 1000);
                },
                
                // Helpers
                updatePlayersList() {
                    const playersSet = new Set();
                    this.loots.forEach(loot => {
                        if (loot.looted_by.name && !loot.looted_by.name.startsWith('@')) {
                            playersSet.add(loot.looted_by.name);
                        }
                    });
                    this.players = Array.from(playersSet);
                },
                
                getItemCategory(itemId) {
                    if (!itemId) return 'other';
                    const id = itemId.toUpperCase();
                    
                    // Equipment
                    if (id.includes('HEAD') || id.includes('ARMOR') || id.includes('SHOES') || 
                        id.includes('MAIN') || id.includes('OFF') || id.includes('CAPE') ||
                        id.includes('BAG') || id.includes('MOUNT') || id.includes('2H') ||
                        id.includes('WEAPON') || id.includes('SHIELD') || id.includes('HELMET') ||
                        id.includes('CHEST') || id.includes('BOOT')) {
                        return 'equipment';
                    }
                    
                    // Consumables
                    if (id.includes('POTION') || id.includes('FOOD') || id.includes('MEAL') ||
                        id.includes('FISH') || id.includes('COOKED') || id.includes('STEW') ||
                        id.includes('SOUP') || id.includes('SALAD') || id.includes('PIE') ||
                        id.includes('SANDWICH')) {
                        return 'consumable';
                    }
                    
                    // Resources
                    if (id.includes('ORE') || id.includes('HIDE') || id.includes('FIBER') ||
                        id.includes('WOOD') || id.includes('ROCK') || id.includes('METALBAR') ||
                        id.includes('LEATHER') || id.includes('CLOTH') || id.includes('PLANKS') ||
                        id.includes('STONEBLOCK') || id.includes('_LEVEL') || id.includes('ESSENCE') ||
                        id.includes('STONE') || id.includes('LOG') || id.includes('COTTON')) {
                        return 'resource';
                    }
                    
                    // Runes
                    if (id.includes('RUNE') || id.includes('SOUL') || id.includes('RELIC') ||
                        id.includes('SHARD') || id.includes('INSIGHT')) {
                        return 'rune';
                    }
                    
                    // Treasure (goes to other)
                    if (id.includes('TREASURE') || id.includes('SILVER') || id.includes('GOLD')) {
                        return 'other';
                    }
                    
                    return 'other';
                },
                
                getCategoryCount(categoryId) {
                    return this.loots.filter(l => this.getItemCategory(l.item_id) === categoryId).length;
                },
                
                getPlayerLootCount(player) {
                    return this.loots.filter(l => l.looted_by.name === player).length;
                },
                
                formatOrigin(name) {
                    if (!name) return '-';
                    // Clean up mob names
                    if (name.startsWith('@')) {
                        return name.replace(/@/g, '').replace(/_/g, ' ').toLowerCase()
                            .replace(/\b\w/g, l => l.toUpperCase())
                            .replace(/Mob /gi, '')
                            .substring(0, 35) + (name.length > 35 ? '...' : '');
                    }
                    return name;
                },
                
                getEnchantColor(tierDisplay) {
                    if (!tierDisplay) return '#71717a';
                    
                    // Verifica encantamento (.1, .2, .3, .4)
                    if (tierDisplay.includes('.4')) return '#eab308'; // Dourado
                    if (tierDisplay.includes('.3')) return '#a855f7'; // Roxo
                    if (tierDisplay.includes('.2')) return '#3b82f6'; // Azul
                    if (tierDisplay.includes('.1')) return '#22c55e'; // Verde
                    
                    // Sem encantamento - cor baseada no tier
                    const tierMatch = tierDisplay.match(/T(\d)/);
                    if (tierMatch) {
                        const tier = parseInt(tierMatch[1]);
                        const tierColors = {
                            4: '#94a3b8', // Cinza claro
                            5: '#94a3b8',
                            6: '#94a3b8',
                            7: '#94a3b8',
                            8: '#94a3b8'
                        };
                        return tierColors[tier] || '#71717a';
                    }
                    
                    return '#71717a';
                },
                
                getItemImageUrl(itemId, size = 60) {
                    if (!itemId) return '';
                    
                    // API oficial do Albion Online para renderizar imagens de itens
                    // Formato: https://render.albiononline.com/v1/item/{ITEM_ID}.png?size={SIZE}
                    return `https://render.albiononline.com/v1/item/${itemId}.png?size=${size}&quality=1`;
                },
                
                // Filter actions
                toggleTier(tier) {
                    const idx = this.filters.tiers.indexOf(tier);
                    if (idx > -1) {
                        this.filters.tiers.splice(idx, 1);
                    } else {
                        this.filters.tiers.push(tier);
                    }
                },
                
                toggleAllTiers() {
                    if (this.allTiersSelected) {
                        this.filters.tiers = [];
                    } else {
                        this.filters.tiers = [4, 5, 6, 7, 8];
                    }
                },
                
                toggleCategory(category) {
                    const idx = this.filters.categories.indexOf(category);
                    if (idx > -1) {
                        this.filters.categories.splice(idx, 1);
                    } else {
                        this.filters.categories.push(category);
                    }
                },
                
                toggleAllCategories() {
                    if (this.allCategoriesSelected) {
                        this.filters.categories = [];
                    } else {
                        this.filters.categories = ['equipment', 'consumable', 'resource', 'rune', 'other'];
                    }
                },
                
                togglePlayer(player) {
                    const idx = this.filters.players.indexOf(player);
                    if (idx > -1) {
                        this.filters.players.splice(idx, 1);
                    } else {
                        this.filters.players.push(player);
                    }
                },
                
                clearFilters() {
                    this.filters = {
                        search: '',
                        tiers: [4, 5, 6, 7, 8],
                        categories: ['equipment', 'consumable', 'resource', 'rune', 'other'],
                        players: [],
                        rareOnly: false
                    };
                },
                
                // Actions
                clearLoots() {
                    if (!confirm('Tem certeza que deseja limpar todos os loots?')) return;
                    
                    fetch('/api/clear', { method: 'POST' })
                        .then(r => r.json())
                        .then(data => {
                            if (data.success) {
                                this.loots = [];
                                this.players = [];
                            }
                        })
                        .catch(err => console.error('[API] Erro:', err));
                },
                
                // ========================================
                // PRICE ESTIMATION (Albion Data Project)
                // ========================================
                priceCache: {},
                
                async getItemPrice(itemId) {
                    // Check cache first (5 min TTL)
                    const cached = this.priceCache[itemId];
                    if (cached && Date.now() - cached.timestamp < 300000) {
                        return cached.price;
                    }
                    
                    try {
                        // Use Albion Data Project API
                        const response = await fetch(`https://west.albion-online-data.com/api/v2/stats/prices/${itemId}.json?locations=Caerleon,Bridgewatch,Martlock,Thetford,FortSterling,Lymhurst`);
                        const data = await response.json();
                        
                        if (data && data.length > 0) {
                            // Get average sell price from all cities
                            const prices = data.filter(d => d.sell_price_min > 0).map(d => d.sell_price_min);
                            const avgPrice = prices.length > 0 ? Math.round(prices.reduce((a, b) => a + b, 0) / prices.length) : 0;
                            
                            // Cache it
                            this.priceCache[itemId] = { price: avgPrice, timestamp: Date.now() };
                            return avgPrice;
                        }
                    } catch (err) {
                        console.warn('[Price API] Error:', err);
                    }
                    
                    return 0;
                },
                
                formatSilver(amount) {
                    if (amount >= 1000000) {
                        return (amount / 1000000).toFixed(1) + 'M';
                    } else if (amount >= 1000) {
                        return (amount / 1000).toFixed(1) + 'K';
                    }
                    return amount.toString();
                },
                
                // Fetch price for a single loot item
                async fetchItemPrice(loot) {
                    const price = await this.getItemPrice(loot.item_id);
                    loot.estimatedPrice = price;
                },
                
                // Fetch prices for multiple loots (batch)
                async fetchPricesForLoots(loots) {
                    // Get unique item IDs
                    const uniqueIds = [...new Set(loots.map(l => l.item_id))];
                    
                    // Fetch prices in batches of 10 to avoid rate limits
                    for (let i = 0; i < uniqueIds.length; i += 10) {
                        const batch = uniqueIds.slice(i, i + 10);
                        
                        await Promise.all(batch.map(async (itemId) => {
                            const price = await this.getItemPrice(itemId);
                            
                            // Update all loots with this item ID
                            loots.forEach(loot => {
                                if (loot.item_id === itemId) {
                                    loot.estimatedPrice = price;
                                }
                            });
                        }));
                        
                        // Small delay between batches
                        if (i + 10 < uniqueIds.length) {
                            await new Promise(r => setTimeout(r, 200));
                        }
                    }
                }
            }
        }
        
        // ========================================
        // SPLASH SCREEN CONTROLLER
        // ========================================
        document.addEventListener('DOMContentLoaded', () => {
            const splash = document.getElementById('splashScreen');
            const main = document.getElementById('mainDashboard');
            const particlesContainer = document.getElementById('particles');
            
            // Create floating particles
            if (particlesContainer) {
                for (let i = 0; i < 20; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'splash-particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 4 + 's';
                    particle.style.animationDuration = (3 + Math.random() * 2) + 's';
                    particlesContainer.appendChild(particle);
                }
            }
            
            // Init Lucide icons
            lucide.createIcons();
            
            // Hide splash after 3 seconds
            setTimeout(() => {
                splash.classList.add('hidden');
                main.style.opacity = '1';
                
                // Remove splash from DOM after animation
                setTimeout(() => {
                    splash.remove();
                }, 800);
            }, 3000);
        });
        
        // ========================================
        // ODOMETER ANIMATION HELPER
        // ========================================
        function animateValue(element, start, end, duration = 500) {
            const range = end - start;
            const startTime = performance.now();
            
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeOut = 1 - Math.pow(1 - progress, 3);
                const current = Math.round(start + range * easeOut);
                
                element.textContent = current.toLocaleString();
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }
    </script>
</body>
</html>
